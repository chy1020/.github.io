<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>贪吃蛇网页版</title>
    <style>
        body { margin: 0; background: black; display: flex; justify-content: center; }
        #gameCanvas { border: 2px solid white; }
        .controls { margin-top: 10px; }
        button { width: 60px; height: 60px; margin: 5px; }
    </style>
</head>
<body>
    <div>
        <canvas id="gameCanvas" width="360" height="750"></canvas>
        <div class="controls">
            <button id="up">↑</button><br>
            <button id="left">←</button>
            <button id="down">↓</button>
            <button id="right">→</button>
            <button id="speed">加速</button>
        </div>
    </div>

    <script>
        // 配置参数
        const WIDTH = 360;
        const HEIGHT = 750;
        const GAME_AREA_HEIGHT = HEIGHT * 3 / 5;
        const GRID_SIZE = 15;
        const GRID_WIDTH = WIDTH / GRID_SIZE;
        const GRID_HEIGHT = GAME_AREA_HEIGHT / GRID_SIZE;

        // 方向和颜色
        const DIRECTIONS = { UP: {x:0, y:-1}, DOWN: {x:0, y:1}, LEFT: {x:-1, y:0}, RIGHT: {x:1, y:0} };
        const COLORS = { BLACK: '#000', WHITE: '#fff', RED: '#f00', GREEN: '#FF69B4', GOLD: '#ffd700' };

        // 获取画布和上下文
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // 游戏状态
        let snake = [{x: GRID_WIDTH/2, y: GRID_HEIGHT/2}];
        let direction = DIRECTIONS.RIGHT;
        let nextDirection = DIRECTIONS.RIGHT;
        let food = createFood();
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let isRunning = false;
        let isAccelerating = false;
        let gameLoop;

        // 音效
        const eatSound = new Audio('assets/吃到金币类.wav');
        const collisionSound = new Audio('assets/失败.wav');
        const bgm = new Audio('assets/游戏音乐.wav');
        bgm.loop = true;

        // 初始化按键事件
        document.getElementById('up').addEventListener('click', () => setDirection(DIRECTIONS.UP));
        document.getElementById('down').addEventListener('click', () => setDirection(DIRECTIONS.DOWN));
        document.getElementById('left').addEventListener('click', () => setDirection(DIRECTIONS.LEFT));
        document.getElementById('right').addEventListener('click', () => setDirection(DIRECTIONS.RIGHT));
        document.getElementById('speed').addEventListener('mousedown', () => isAccelerating = true);
        document.getElementById('speed').addEventListener('mouseup', () => isAccelerating = false);
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ') isRunning ? pauseGame() : startGame();
            if (e.key === 'ArrowUp') setDirection(DIRECTIONS.UP);
            if (e.key === 'ArrowDown') setDirection(DIRECTIONS.DOWN);
            if (e.key === 'ArrowLeft') setDirection(DIRECTIONS.LEFT);
            if (e.key === 'ArrowRight') setDirection(DIRECTIONS.RIGHT);
        });

        // 绘制开始界面
        drawStartScreen();

        // 核心函数（与Python逻辑对应）
        function createFood() {
            while (true) {
                const food = {
                    x: Math.floor(Math.random() * GRID_WIDTH),
                    y: Math.floor(Math.random() * GRID_HEIGHT)
                };
                if (!snake.some(seg => seg.x === food.x && seg.y === food.y)) return food;
            }
        }

        function setDirection(newDir) {
            if (isRunning && 
                !(newDir.x === -direction.x && newDir.y === -direction.y)) {
                nextDirection = newDir;
            }
        }

        function startGame() {
            isRunning = true;
            bgm.play();
            gameLoop = setInterval(updateGame, 150);
        }

        function updateGame() {
            direction = nextDirection;
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};
            // 碰撞检测
            if (head.x < 0 || head.x >= GRID_WIDTH || head.y < 0 || head.y >= GRID_HEIGHT ||
                snake.some(seg => seg.x === head.x && seg.y === head.y)) {
                gameOver();
                return;
            }
            snake.unshift(head);
            // 吃食物
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                eatSound.play();
                food = createFood();
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('snakeHighScore', highScore);
                }
            } else {
                snake.pop();
            }
            drawGame();
        }

        function drawGame() {
            // 清空画布
            ctx.fillStyle = COLORS.BLACK;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            // 画蛇
            snake.forEach((seg, i) => {
                ctx.fillStyle = i === 0 ? COLORS.GREEN : COLORS.GOLD;
                ctx.fillRect(seg.x*GRID_SIZE, seg.y*GRID_SIZE, GRID_SIZE-1, GRID_SIZE-1);
                if (i === 0) {
                    ctx.fillStyle = COLORS.BLACK;
                    ctx.fillText('李', seg.x*GRID_SIZE+5, seg.y*GRID_SIZE+12);
                }
            });
            // 画食物
            ctx.fillStyle = COLORS.RED;
            ctx.beginPath();
            ctx.arc(food.x*GRID_SIZE+GRID_SIZE/2, food.y*GRID_SIZE+GRID_SIZE/2, GRID_SIZE/2, 0, Math.PI*2);
            ctx.fill();
            // 画分数
            ctx.fillStyle = COLORS.WHITE;
            ctx.fillText(`分数: ${score}`, 10, 20);
            ctx.fillText(`最高分: ${highScore}`, WIDTH-100, 20);
        }

        function gameOver() {
            isRunning = false;
            clearInterval(gameLoop);
            bgm.pause();
            collisionSound.play();
            ctx.fillStyle = COLORS.BLACK;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = COLORS.RED;
            ctx.fillText('游戏结束', WIDTH/2-40, HEIGHT/2);
            ctx.fillStyle = COLORS.WHITE;
            ctx.fillText(`分数: ${score}`, WIDTH/2-30, HEIGHT/2+30);
            ctx.fillText('按空格重新开始', WIDTH/2-60, HEIGHT/2+60);
        }

        function drawStartScreen() {
            ctx.fillStyle = COLORS.BLACK;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            ctx.fillStyle = COLORS.GREEN;
            ctx.fillText('贪吃蛇游戏', WIDTH/2-50, HEIGHT/2-50);
            ctx.fillStyle = COLORS.WHITE;
            ctx.fillText('按空格开始', WIDTH/2-40, HEIGHT/2);
        }
    </script>
</body>
</html>